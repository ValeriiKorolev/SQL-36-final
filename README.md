## SQL-36-final
    1. В работе использовался локальный тип подключения (восстановление из *.backup файла).
![image](https://user-images.githubusercontent.com/94550891/209460935-62158833-3f29-4df0-aa66-b2f3599f74a5.png)
    
    2. Скриншот ER-диаграммы из DBeaver`a.
![image](https://user-images.githubusercontent.com/94550891/209460948-4e78ba43-622e-4803-9730-16530f36f24e.png)
    3. Краткое описание БД - из каких таблиц и представлений состоит.

База данных состоит из следующих объектов:

![image](https://user-images.githubusercontent.com/94550891/209460980-883d0a6a-41bf-421b-a769-7086bf3b6c97.png)

    4. Развернутый анализ БД - описание таблиц, логики, связей и бизнес области. 

Бизнес – область базы данных – авиаперевозки по России. 
Основной сущностью является бронирование (bookings). Бронь (book_ref) может быть выписана на нескольких пассажиров, для каждого выписывается отдельный билет (ticket_no), содержащий информацию о пассажире. В билете может быть несколько перелетов (flight_id), если между аэропортами маршрута нет прямых рейсов, либо билет «туда/обратно».
Вся информация о перелетах содержится в таблице flights (номер рейса, аэропорт вылета/прилета, время вылета/прилета). Данные по аэропортам и городам их нахождения - таблица airports.
При регистрации на рейс пассажиру выдается посадочный талон (boarding_no), в котором указывается место в самолете (seat_no). Пассажир может зарегистрироваться только на тот рейс, который есть у него в билете.  

Данные о самолетах, количестве мест и их классах обслуживания содержатся в таблицах aircrafts и seats.

4.1 aircrafts

    • Код воздушного судна (ВС), модель ВС, максимальная дальность полёта (км)
    • Каждая модель воздушного судна идентифицируется своим трехзначным кодом (aircraft_code). 
    Указывается также название модели (model) и максимальная дальность полета в километрах (range).
    • Индексы: PRIMARY KEY, btree (aircraft_code)
    • Ограничения-проверки: CHECK (range > 0)
    • Ссылки извне:
    TABLE "flights" FOREIGN KEY (aircraft_code) REFERENCES aircrafts(aircraft_code)
    TABLE "seats" FOREIGN KEY (aircraft_code) REFERENCES aircrafts(aircraft_code) ON DELETE CASCADE

4.2 airports

    • Код аэропорта, название аэропорта, город, координаты (долгота/широта), временная зона аэропорта
    • Аэропорт идентифицируется трехбуквенным кодом (airport_code) и имеет свое имя (airport_name). 
    Для города не предусмотрено отдельной сущности, но название (city) указывается и может служить для того, 
    чтобы определить аэропорты одного города.
    Также указывается широта (longitude), долгота (latitude) и часовой пояс (timezone).
    • Индексы: PRIMARY KEY, btree (airport_code)
    • Ссылки извне:
    TABLE "flights" FOREIGN KEY (arrival_airport) REFERENCES airports(airport_code)
    TABLE "flights" FOREIGN KEY (departure_airport) REFERENCES airports(airport_code)

4.3 boarding_passes

    • Номер билета, id рейса, номер посадочного, номер места
    • При регистрации на рейс, которая возможна за сутки до плановой даты отправления, 
    пассажиру выдается посадочный талон. Он идентифицируется также, как и перелет — номером билета
    и номером рейса. Посадочным талонам присваиваются последовательные номера (boarding_no)
    в порядке регистрации пассажиров на рейс (этот номер будет уникальным только в пределах данного рейса). 
    В посадочном талоне указывается номер места (seat_no).
    • Индексы:
    PRIMARY KEY, btree (ticket_no, flight_id)
    UNIQUE CONSTRAINT, btree (flight_id, boarding_no)
    UNIQUE CONSTRAINT, btree (flight_id, seat_no)
    • Ограничения внешнего ключа: FOREIGN KEY (ticket_no, flight_id) REFERENCES ticket_flights(ticket_no, flight_id)
    
4.4 bookings

    • Номер бронирования, дата бронирования, полная сумма бронирования
    • Пассажир заранее (book_date, максимум за месяц до рейса) бронирует билет себе и, 
    возможно, нескольким другим пассажирам. Бронирование идентифицируется номером 
    (book_ref, шестизначная комбинация букв и цифр). Поле total_amount хранит общую стоимость включенных 
    в бронирование перелетов всех пассажиров.
    • Индексы: PRIMARY KEY, btree (book_ref)
    • Ссылки извне: TABLE "tickets" FOREIGN KEY (book_ref) REFERENCES bookings(book_ref)
    
 4.5 flights
 
    • id рейса, номер рейса, время вылета и прилета по расписанию, аэропорты отправления и прибытия, 
    статус рейса, код ВС, фактическое время вылета и прилета
    • Естественный ключ таблицы рейсов состоит из двух полей — номера рейса (flight_no) и 
    даты отправления (scheduled_departure). Чтобы сделать внешние ключи на эту таблицу компактнее, в качестве 
    первичного используется суррогатный ключ (flight_id). Рейс всегда соединяет две точки — аэропорты вылета 
    (departure_airport) и прибытия (arrival_airport). Такое понятие, как «рейс с пересадками» отсутствует: 
    если из одного аэропорта до другого нет прямого рейса, в билет просто включаются несколько необходимых рейсов. 
    У каждого рейса есть запланированные дата и время вылета (scheduled_departure) и прибытия (scheduled_arrival). 
    Реальные время вылета (actual_departure) и прибытия (actual_arrival) могут отличаться: обычно не сильно, 
    но иногда и на несколько часов, если рейс задержан. Статус рейса (status) может принимать одно из следующих значений: 
        ◦ Scheduled Рейс доступен для бронирования. Это происходит за месяц до плановой даты вылета; 
        до этого запись о рейсе не существует в базе данных. 
        ◦ On Time Рейс доступен для регистрации (за сутки до плановой даты вылета) и не задержан. 
        ◦ Delayed Рейс доступен для регистрации (за сутки до плановой даты вылета), но задержан. 
        ◦ Departed Самолет уже вылетел и находится в воздухе.  
        ◦ Arrived Самолет прибыл в пункт назначения. 
        ◦ Cancelled Рейс отменен
    • Индексы:
    PRIMARY KEY, btree (flight_id)
    UNIQUE CONSTRAINT, btree (flight_no, scheduled_departure)
    • Ограничения-проверки:
    CHECK (scheduled_arrival > scheduled_departure)
    CHECK ((actual_arrival IS NULL) OR ((actual_departure IS NOT NULL AND actual_arrival IS NOT NULL) 
          AND (actual_arrival > actual_departure)))
    CHECK (status IN ('On Time', 'Delayed', 'Departed', 'Arrived', 'Scheduled', 'Cancelled'))
    • Ограничения внешнего ключа:
    FOREIGN KEY (aircraft_code) REFERENCES aircrafts(aircraft_code)
    FOREIGN KEY (arrival_airport) REFERENCES airports(airport_code)
    FOREIGN KEY (departure_airport) REFERENCES airports(airport_code)
    • Ссылки извне:
    TABLE "ticket_flights" FOREIGN KEY (flight_id) REFERENCES flights(flight_id)

4.6 flights_v

    • Представление: идентификатор рейса, номер рейса, время вылета по расписанию + местное, 
    время прилета по расписанию + местное, планируемая продолжительность полета, код аэропорта отправления, 
    название аэропорта отправления, город отправления, код аэропорта прибытия, название аэропорта прибытия, 
    город прибытия, статус рейса, код самолета, фактическое время вылета + местное, фактическое время прилета + местное, 
    фактическая продолжительность полета
    • Над таблицей flights создано представление flights_v, содержащее дополнительную информацию: 
    • расшифровку данных об аэропорте вылета (departure_airport, departure_airport_name, departure_city), 
    • расшифровку данных об аэропорте прибытия (arrival_airport, arrival_airport_name, arrival_city), 
    • местное время вылета (scheduled_departure_local, actual_departure_local), 
    • местное время прибытия (scheduled_arrival_local, actual_arrival_local), 
    • продолжительность полета (scheduled_duration, actual_duration).

4.7 routes

    • Материализованное представление: номер рейса, код аэропорта отправления, название аэропорта отправления, город отправления, 
    код аэропорта прибытия, название аэропорта прибытия, город прибытия, код самолёта, продолжительность полета, дни недели, 
    когда выполняется рейс
    • Таблица рейсов содержит избыточность: из нее можно было бы выделить информацию о маршруте (номер рейса, аэропорты 
    отправления и назначения), которая не зависит от конкретных дат рейсов. Именно такая информация и составляет материализованное 
    представление routes.
    
4.8 seats

    • код ВС, номер места, класс обслуживания
    • Места определяют схему салона каждой модели. Каждое место определяется своим номером (seat_no) и имеет закрепленный за ним класс 
    обслуживания (fare_conditions) — Economy, Comfort или Business.
    • Индексы: PRIMARY KEY, btree (aircraft_code, seat_no)
    • Ограничения-проверки: CHECK (fare_conditions IN ('Economy', 'Comfort', 'Business'))
    • Ограничения внешнего ключа: FOREIGN KEY (aircraft_code) REFERENCES aircrafts(aircraft_code) ON DELETE CASCADE

4.9 ticket_flights

    • номер билета, id рейса, класс обслуживания, стоимость перелета
    • Перелет соединяет билет с рейсом и идентифицируется их номерами. Для каждого перелета указываются его стоимость (amount) и 
    класс обслуживания (fare_conditions).
    • Индексы: PRIMARY KEY, btree (ticket_no, flight_id)
    • Ограничения-проверки:
    CHECK (amount >= 0) 
    CHECK (fare_conditions IN ('Economy', 'Comfort', 'Business'))
    • Ограничения внешнего ключа:
    FOREIGN KEY (flight_id) REFERENCES flights(flight_id) 
    FOREIGN KEY (ticket_no) REFERENCES tickets(ticket_no)
    • Ссылки извне: 
    TABLE "boarding_passes" FOREIGN KEY (ticket_no, flight_id) REFERENCES ticket_flights(ticket_no, flight_id)

4.10 tickets

    • номер билета, номер бронирования, id пассажира, ФИ пассажира, контактные данные пассажира
    • Билет имеет уникальный номер (ticket_no), состоящий из 13 цифр. Билет содержит идентификатор пассажира (passenger_id) — 
    номер документа, удостоверяющего личность, — его фамилию и имя (passenger_name) и контактную информацию (contact_date). 
    Ни идентификатор пассажира, ни имя не являются постоянными (можно поменять паспорт, можно сменить фамилию), поэтому однозначно 
    найти все билеты одного и того же пассажира невозможно.
    • Индексы: PRIMARY KEY, btree (ticket_no)
    • Ограничения внешнего ключа: FOREIGN KEY (book_ref) REFERENCES bookings(book_ref)
    • Ссылки извне: TABLE "ticket_flights" FOREIGN KEY (ticket_no) REFERENCES tickets(ticket_no)

Бизнес задачи, которые можно решить, используя БД.

Авиаперевозчик, как любая коммерческая организация заинтересован в рентабельности бизнеса и увеличении прибыли. Ключевыми факторами 
доходной части компании являются стоимость билетов и заполнение рейсов. 
 БД позволяет проанализировать заполняемость самолетов в зависимости от направлений полетов, сезонных изменений пассажиропотока. 
 На заполняемость могут влиять дни недели. Исходя из этого перевозчик может принимать меры по увеличению заполняемости, а именно:
 
 • Распределение летного парка по маршрутам, исходя из вместимости самолетов и пассажиропотока.
 
 • Изменение расписания полетов (сезонное, увеличение рейсов в одних направлениях и снижение в других.
 
 • Объединение рейсов
 
 • Объединение пассажиропотоков в рамках альянсов авиакомпаний
 
 • Скидки, если позволяет рентабельность.
 
Информация БД позволить планировать закупки новых самолетов, исходя из предполагаемых маршрутов их использования. 
На более длинных временных интервалах можно прогнозировать (в комплексе с другими социально-экономическими, политическими и т.д. 
факторами) увеличение/снижение пассажиропотока на каких-то направлениях. Это позволит вовремя уйти с теряющих рентабельность маршрутов 
и подготовиться и увеличить присутствие на перспективных направлениях.
Безусловно надо использовать клиентскую базу пассажиров, хотя информации о них у компании не так много. На мой взгляд, можно сделать 
некий частотный анализ полетов пассажиров. Будет определенный поток пассажиров, часто использующих авиаперелеты. Например, очень много 
нижегородцев работают в Москве и на выходные приезжают в Нижний Новгород. Многие летают самолетом, потому что удобное расписание и 
приемлемая цена. Изменив расписание, можно потерять стабильный, постоянный поток пассажиров, который уйдет на железную дорогу.      

Список SQL запросов из приложения №2 с описанием логики их выполнения.

https://github.com/ValeriiKorolev/SQL-36-final/blob/master/SQL-36%20final%20code.sql
